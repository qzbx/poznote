<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="../css/reset.css">
    <link rel="stylesheet" type="text/css" href="../css/style.css">
    <script>
      // mathjax の設定
      MathJax = {
        chtml: {
          matchFontHeight: false
        },
        tex: {
          inlineMath: [['$', '$']]
        }
      };
    </script>
    <script id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>
    <script>
      // livereload の設定
      document.write(
        '<script src="http://' + 
        (location.host || 'localhost').split(':')[0] + 
        ':35729/livereload.js?snipver=1"></' + 
        'script>'
      )
    </script>
  </head>
  <body>
<nav class="toc"><h1 id="poznote">PozNote</h1>
<ol>
<li><a href="README.html">はじめに</a></li>
<li><a href="sample.html">サンプル</a><ol>
<li><a href="title.html">タイトル</a></li>
<li><a href="paragraph.html">地の文と装飾</a></li>
<li><a href="lists.html">リスト</a></li>
<li><a href="tables.html">図表</a></li>
<li><a href="others.html">その他</a></li>
</ol>
</li>
</ol>
</nav><article id="md" class="md"><h1 id="poznote">PozNote</h1>
<p>.md で快適にノートを取りたい<br>複数の .md ファイルをひとつのプロジェクトとして管理・プレビューしたい</p>
<h2 id="feature">Feature</h2>
<ul>
<li>.md をリアルタイムで .html に変換する</li>
<li>ブラウザで表示している .html をホットリロードする</li>
<li>リロード時にスクロール位置が狂わない（一番下のときはそのまま追従する）</li>
<li>MathJax 対応</li>
<li>点丸をピリカンに置換（選択可能にしたい TODO）</li>
<li>サイドバーにファイル横断の目次を表示する</li>
</ul>
<h2 id="仕組み">仕組み</h2>
<p><code>./md</code> 以下を監視して，<code>./md/(sample).md</code> が変更されたら自動で <code>./html/(sample).html</code> を作成する</p>
<h2 id="つかいかた">つかいかた</h2>
<h3 id="初期設定">初期設定</h3>
<pre><code>% sudo npm i -g livereloadx
% git clone https://github.com/qzbx/poznote.git
% cd poznote
% npm i
</code></pre>
<h3 id="起動">起動</h3>
<pre><code>% npm run start
</code></pre>
<h3 id="編集">編集</h3>
<ol>
<li><code>poznote/md</code> 以下に <code>(filename).md</code> を作成する</li>
<li>ブラウザで <code>poznote/html</code> 以下に作成された対応する <code>(filename).html</code> を表示する</li>
<li>見ながら <code>(filename).md</code> を編集する</li>
</ol>
<h2 id="reference">Reference</h2>
<ul>
<li>livereloadx <a href="https://nitoyon.github.io/livereloadx/">https://nitoyon.github.io/livereloadx/</a></li>
<li>HTML5 Reset Stylesheet <a href="http://html5doctor.com/html-5-reset-stylesheet/">http://html5doctor.com/html-5-reset-stylesheet/</a></li>
</ul>
</article>
  </body>
  <script>
    // リロードの直前にスクロール量を保存する
    window.onbeforeunload = () => {
      const elm = document.getElementById("md");
      sessionStorage.setItem("poznote-scroll", String(elm.scrollTop));
      const bottom = elm.scrollHeight - elm.clientHeight; // not just fit
      if (elm.scrollTop >= bottom) { // 一番下までいってた場合は追従する
        sessionStorage.setItem("poznote-bottom", "true");
      }
    };
  </script>
  <script defer>
    // リロード時に直前のスクロール量を復元する
    const elm = document.getElementById("md");
    const y = sessionStorage.getItem("poznote-scroll");
    const b = sessionStorage.getItem("poznote-bottom");
    if (y) {
      if (b) { // 一番下までスクロールされてた場合は追従する
        const bottom = elm.scrollHeight;
        elm.scroll(0, bottom)
        sessionStorage.removeItem("poznote-scroll");
        sessionStorage.removeItem("poznote-bottom");
      } else {
        elm.scroll(0, y);
        sessionStorage.removeItem("poznote-scroll");
      }
    }
  </script>
</html>